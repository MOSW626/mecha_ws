# κ°λ‰λ λ²½ μ¶”μΆ… μ‹μ¤ν… (κ³ μ† μµμ ν™” λ²„μ „)

## π€ κ³ μ† μµμ ν™” κ°μ„  μ‚¬ν•­

### μ†λ„ ν–¥μƒ μµμ ν™”
- **κΈ°λ³Έ μ†λ„ μ¦κ°€**: 85 β†’ 95
- **μµλ€ μ†λ„ μ¦κ°€**: 95 β†’ 100
- **μµμ† μ†λ„ μ¦κ°€**: 40 β†’ 60 (κ³΅μ„ μ—μ„λ„ λ” λΉ λ¥΄κ²)
- **μ†λ„ κ°μ† κ³„μ κ°μ†**: κ³΅μ„ μ—μ„λ„ λ” λΉ λ¥Έ μ£Όν–‰
- **μ§μ„  κµ¬κ°„ μ†λ„ λ¶€μ¤νΈ**: μ§μ„  κ°μ§€ μ‹ μ¶”κ°€ μ†λ„ μ¦κ°€

### μ μ–΄ μ£ΌκΈ° μµμ ν™”
- **μ μ–΄ μ£ΌκΈ°**: 1ms β†’ 0.5ms (2000 Hz)
- **μ„Όμ„ μ£ΌκΈ°**: 3ms β†’ 2ms (500 Hz)
- **κ³ μ • μ£ΌκΈ° μ μ–΄**: λ” μ •ν™•ν• νƒ€μ΄λ° μ μ–΄

### PID κ²μΈ μµμ ν™”
- **λ” κ³µκ²©μ μΈ κ²μΈ**: λΉ λ¥Έ λ°μ‘μ„±
- **λ―Έλ¶„ κ²μΈ μ¦κ°€**: μ§„λ™ μ–µμ  κ°•ν™”
- **κ³ μ • μ£ΌκΈ° PID**: λ” μμΈ΅ κ°€λ¥ν• μ μ–΄

### ν•„ν„°λ§ μµμ ν™”
- **μ¤‘μ•™κ°’ ν•„ν„° ν¬κΈ°**: 5 β†’ 3 (λ” λΉ λ¥Έ λ°μ‘)
- **EMA κ³„μ**: 0.75 β†’ 0.80 (λ” λΉ λ¥Έ λ°μ‘)

## κ°μ„  μ‚¬ν•­

### 1. **PID μ μ–΄λ΅ μ—…κ·Έλ μ΄λ“**
- κΈ°μ΅΄ P μ μ–΄ β†’ PID μ μ–΄λ΅ λ³€κ²½
- λ” μ•μ •μ μ΄κ³  μ •ν™•ν• μ μ–΄
- μ λ¶„ ν•­(Integral)μΌλ΅ μ •μƒ μƒνƒ μ¤μ°¨ μ κ±°
- λ―Έλ¶„ ν•­(Derivative)μΌλ΅ μ¤λ²„μνΈ κ°μ†

### 2. **ν–¥μƒλ ν•„ν„°λ§**
- μ¤‘μ•™κ°’ ν•„ν„° + EMA ν•„ν„° μ΅°ν•©
- λ…Έμ΄μ¦μ™€ μ΄μƒμΉμ— λ” κ°•κ±΄ν•¨
- λ¶€λ“λ¬μ΄ κ±°λ¦¬ μΈ΅μ •κ°’ μ κ³µ

### 3. **κ°μ„ λ λ¨λ“ μ „ν™ λ΅μ§**
- νμ¤ν…λ¦¬μ‹μ¤ μ μ©μΌλ΅ μ±„ν„°λ§ λ°©μ§€
- PID μƒνƒ μ΄κΈ°ν™”λ΅ μ „ν™ μ‹ μ•μ •μ„± ν–¥μƒ

### 4. **μµμ ν™”λ μ†λ„ μ μ–΄**
- μ§€μ κ°μ† κ³΅μ„  μ‚¬μ©
- κ°λ„ λ³€ν™”μ— λ”°λ¥Έ λ¶€λ“λ¬μ΄ μ†λ„ μ΅°μ 
- λ” λΉ λ¥΄κ³  μ•μ •μ μΈ μ£Όν–‰

### 5. **κµ¬μ΅°ν™”λ νλΌλ―Έν„°**
- `ControlParams` ν΄λμ¤λ΅ λ¨λ“  νλΌλ―Έν„° μ¤‘μ•™ κ΄€λ¦¬
- νλ‹μ΄ ν›¨μ”¬ μ‰¬μ›μ§

## μ£Όμ” νλΌλ―Έν„° νλ‹ κ°€μ΄λ“

### PID κ²μΈ μ΅°μ •

#### RIGHT λ¨λ“ PID
```python
Kp_r = 6.0   # λΉ„λ΅€ κ²μΈ (λ†’μ„μλ΅ λΉ λ¥Έ λ°μ‘, λ„λ¬΄ λ†’μΌλ©΄ μ§„λ™)
Ki_r = 0.05  # μ λ¶„ κ²μΈ (μ •μƒ μƒνƒ μ¤μ°¨ μ κ±°, λ„λ¬΄ λ†’μΌλ©΄ μ¤λ²„μνΈ)
Kd_r = 1.5   # λ―Έλ¶„ κ²μΈ (μ§„λ™ μ–µμ , λ„λ¬΄ λ†’μΌλ©΄ λ…Έμ΄μ¦μ— λ―Όκ°)
```

**νλ‹ μμ„:**
1. `Kp`λ¥Ό μ΅°μ •ν•μ—¬ κΈ°λ³Έ λ°μ‘μ„± μ„¤μ •
2. `Kd`λ¥Ό μ΅°μ •ν•μ—¬ μ§„λ™ μ–µμ 
3. `Ki`λ¥Ό μ΅°μ •ν•μ—¬ μ •μƒ μƒνƒ μ¤μ°¨ μ κ±°

#### LEFT λ¨λ“ PID
```python
Kp_l = 4.5
Ki_l = 0.03
Kd_l = 1.2
```

### μ†λ„ νλΌλ―Έν„°

```python
speed_base = 85.0    # κΈ°λ³Έ μ†λ„ (λ†’μ„μλ΅ λΉ λ¦„)
speed_max = 95.0     # μµλ€ μ†λ„ μ ν•
speed_min = 40.0     # μµμ† μ†λ„ μ ν•

speed_angle_factor_r = 0.5  # RIGHT λ¨λ“ μ†λ„ κ°μ† κ³„μ
speed_angle_factor_l = 0.4  # LEFT λ¨λ“ μ†λ„ κ°μ† κ³„μ
```

**νλ‹ ν:**
- κ³΅μ„  κµ¬κ°„μ—μ„ μ†λ„κ°€ λ„λ¬΄ λλ¦¬λ©΄ `speed_base` μ¦κ°€
- μ§μ„  κµ¬κ°„μ—μ„λ„ μ†λ„κ°€ λλ¦¬λ©΄ `speed_angle_factor` κ°μ†

### ν•„ν„°λ§ νλΌλ―Έν„°

```python
smoothing_alpha = 0.75      # EMA ν•„ν„° κ³„μ (0~1)
median_filter_size = 5       # μ¤‘μ•™κ°’ ν•„ν„° ν¬κΈ°
```

**νλ‹ ν:**
- μ„Όμ„ κ°’μ΄ λ„λ¬΄ λ…Έμ΄μ¦κ°€ λ§μΌλ©΄ `smoothing_alpha` κ°μ† (λ” μ¤λ¬΄μ¤)
- λ°μ‘μ΄ λ„λ¬΄ λλ¦¬λ©΄ `smoothing_alpha` μ¦κ°€
- `median_filter_size`λ” ν™€μλ΅ μ μ§€ (3, 5, 7 κ¶μ¥)

### λ¨λ“ μ „ν™ νλΌλ―Έν„°

```python
right_to_left_thresh = 55.0   # RIGHT -> LEFT μ „ν™ μ„κ³„κ°’ (cm)
left_to_right_thresh = 25.0   # LEFT -> RIGHT μ „ν™ μ„κ³„κ°’ (cm)
mode_switch_delay = 0.25      # μ „ν™ μ§€μ—° μ‹κ°„ (μ΄)
```

**νλ‹ ν:**
- λ¨λ“ μ „ν™μ΄ λ„λ¬΄ λΉ¨λ¦¬ μΌμ–΄λ‚λ©΄ `mode_switch_delay` μ¦κ°€
- μ „ν™μ΄ μ• μΌμ–΄λ‚λ©΄ μ„κ³„κ°’ μ΅°μ •
- νμ¤ν…λ¦¬μ‹μ¤(λ‘ μ„κ³„κ°’ μ°¨μ΄)κ°€ μ¶©λ¶„ν μ»¤μ•Ό μ±„ν„°λ§ λ°©μ§€

### κΈ°μ¤€ κ±°λ¦¬

```python
ref_distance_right = 15.0  # RIGHT λ¨λ“ κΈ°μ¤€ κ±°λ¦¬ (cm)
ref_distance_left = 15.0   # LEFT λ¨λ“ κΈ°μ¤€ κ±°λ¦¬ (cm)
```

**νλ‹ ν:**
- νΈλ™ ν­μ— λ§κ² μ΅°μ •
- λ²½μ—μ„ λ©€λ¦¬ λ–¨μ–΄μ Έ μ£Όν–‰ν•λ ¤λ©΄ κ°’ μ¦κ°€

## μ‚¬μ© λ°©λ²•

```bash
cd Yeonsu_track
python3 improved_wall_following.py
```

## λ¬Έμ  ν•΄κ²°

### μ§„λ™μ΄ μ‹¬ν• κ²½μ°
1. `Kp` κ°’ κ°μ†
2. `Kd` κ°’ μ¦κ°€
3. `smoothing_alpha` κ°μ†

### λ°μ‘μ΄ λλ¦° κ²½μ°
1. `Kp` κ°’ μ¦κ°€
2. `smoothing_alpha` μ¦κ°€
3. `control_period` κ°μ† (CPU μ—¬μ  μμ„ λ•)

### λ¨λ“ μ „ν™μ΄ λ¶μ•μ •ν• κ²½μ°
1. `mode_switch_delay` μ¦κ°€
2. `right_to_left_thresh`μ™€ `left_to_right_thresh` μ°¨μ΄ μ¦κ°€
3. ν•„ν„°λ§ κ°•ν™” (`smoothing_alpha` κ°μ†)

### μ†λ„κ°€ λ„λ¬΄ λλ¦° κ²½μ°
1. `speed_base` μ¦κ°€
2. `speed_angle_factor` κ°μ†
3. `speed_min` μ¦κ°€

## μ„±λ¥ λΉ„κµ

| ν•­λ© | κΈ°μ΅΄ μ½”λ“ | κ°λ‰ μ½”λ“ |
|------|----------|----------|
| μ μ–΄ λ°©μ‹ | P μ μ–΄ | PID μ μ–΄ |
| ν•„ν„°λ§ | λ‹¨μ EMA | μ¤‘μ•™κ°’ + EMA |
| λ¨λ“ μ „ν™ | λ‹¨μ μ„κ³„κ°’ | νμ¤ν…λ¦¬μ‹μ¤ |
| μ†λ„ μ μ–΄ | μ„ ν• κ°μ† | μ§€μ κ³΅μ„  |
| νλΌλ―Έν„° κ΄€λ¦¬ | λ¶„μ‚° | μ¤‘μ•™ μ§‘μ¤‘ |

## μ£Όμμ‚¬ν•­

1. **νλΌλ―Έν„° νλ‹ μ‹ ν• λ²μ— ν•λ‚μ”©λ§ λ³€κ²½**ν•κ³  ν…μ¤νΈν•μ„Έμ”
2. **μ•μ „μ„ μ„ν•΄ μ²μμ—λ” λ‚®μ€ μ†λ„λ΅ μ‹μ‘**ν•μ„Έμ”
3. **νΈλ™ ν™κ²½μ— λ§κ² κΈ°μ¤€ κ±°λ¦¬λ¥Ό μ΅°μ •**ν•μ„Έμ”
4. **μ„Όμ„κ°€ μ λ€λ΅ μ‘λ™ν•λ”μ§€ ν™•μΈ**ν•μ„Έμ”

