# 고속 최적화 가이드

## 주요 변경 사항

### 1. 속도 파라미터 최적화

#### 변경 전 → 변경 후
```python
speed_base = 85.0  →  95.0   (+10)
speed_max = 95.0   →  100.0  (+5)
speed_min = 40.0   →  60.0   (+20)
```

**효과:**
- 직선 구간에서 약 12% 빠른 주행
- 곡선 구간에서도 최소 50% 빠른 주행

#### 속도 감소 계수
```python
speed_angle_factor_r = 0.5  →  0.35  (-30%)
speed_angle_factor_l = 0.4   →  0.30  (-25%)
```

**효과:**
- 곡선에서도 더 빠른 속도 유지
- 전체 주행 시간 단축

### 2. 적응형 속도 제어

#### 직선 구간 감지
- 각도 변화가 3도 미만이면 직선으로 판단
- 직선 구간에서 최대 속도 + 5 부스트

#### 곡선 구간 최적화
- 곡선에서도 완만한 속도 감소
- 최소 속도가 60으로 증가하여 곡선에서도 빠름

### 3. 제어 주기 최적화

#### 변경 전 → 변경 후
```python
control_period = 0.001s  →  0.0005s  (2배 빠름)
sensor_read_period = 0.003s  →  0.002s  (1.5배 빠름)
```

**효과:**
- 더 빠른 반응성
- 더 정밀한 제어
- 고정 주기로 예측 가능한 동작

### 4. PID 게인 최적화

#### RIGHT 모드
```python
Kp_r = 6.0  →  7.5   (+25%)
Kd_r = 1.5  →  2.0   (+33%)
```

#### LEFT 모드
```python
Kp_l = 4.5  →  6.0   (+33%)
Kd_l = 1.2  →  1.8   (+50%)
```

**효과:**
- 더 빠른 오차 보정
- 진동 억제 강화
- 안정적인 고속 주행

### 5. 필터링 최적화

#### 중앙값 필터
```python
median_filter_size = 5  →  3  (-40%)
```

**효과:**
- 더 빠른 반응 (지연 감소)
- 계산량 감소

#### EMA 필터
```python
smoothing_alpha = 0.75  →  0.80  (+7%)
```

**효과:**
- 더 빠른 반응성
- 여전히 노이즈 필터링 유지

## 성능 비교

| 항목 | 기존 버전 | 고속 최적화 버전 | 개선율 |
|------|----------|-----------------|--------|
| 기본 속도 | 85 | 95 | +12% |
| 최대 속도 | 95 | 100 | +5% |
| 최소 속도 | 40 | 60 | +50% |
| 제어 주기 | 1ms | 0.5ms | 2배 |
| 센서 주기 | 3ms | 2ms | 1.5배 |
| 곡선 속도 | 낮음 | 높음 | +50% |

## 사용 팁

### 1. 처음 사용 시
- 안전을 위해 `speed_base`를 90 정도로 시작
- 안정적으로 주행하면 점진적으로 증가

### 2. 트랙별 조정
- **넓은 트랙**: `speed_base = 100`, `speed_max = 100`
- **좁은 트랙**: `speed_base = 90`, `speed_max = 95`
- **급커브**: `speed_angle_factor`를 0.4로 증가

### 3. 안정성 문제 시
- `Kp` 값을 10% 감소
- `smoothing_alpha`를 0.75로 감소
- `speed_base`를 5~10 감소

### 4. 더 빠르게 하고 싶을 때
- `speed_max = 100` 유지
- `speed_angle_factor`를 0.25로 감소
- `straight_speed_boost`를 10으로 증가

## 주의사항

⚠️ **고속 주행 시 주의:**
1. 센서가 정확히 작동하는지 확인
2. 트랙 폭에 맞게 `ref_distance` 조정
3. 처음에는 낮은 속도로 테스트
4. 안전 거리(`min_safe_distance`) 확인

## 추가 최적화 가능 사항

### 1. 예측 제어
- 곡선 반경 예측하여 미리 속도 조절
- 더 공격적인 곡선 진입

### 2. 적응형 PID
- 속도에 따라 PID 게인 자동 조정
- 고속에서 더 공격적인 제어

### 3. 센서 융합
- 여러 센서 데이터 융합
- 더 정확한 거리 측정

## 문제 해결

### 진동 발생
```python
Kp_r = 7.5  →  6.5  # 감소
Kd_r = 2.0  →  2.5  # 증가
```

### 반응 지연
```python
smoothing_alpha = 0.80  →  0.85  # 증가
median_filter_size = 3  →  3  # 유지
```

### 속도가 너무 빠름
```python
speed_base = 95  →  90  # 감소
speed_max = 100  →  95  # 감소
```

