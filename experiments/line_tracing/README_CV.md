# 컴퓨터 비전 기반 라인트레이싱 (ML 없이)

ML 모델 없이 전통적인 컴퓨터 비전 기법을 사용한 라인트레이싱입니다.

## 장점

1. **빠른 처리 속도**: ML 추론 없이 순수 이미지 처리만 사용
2. **낮은 리소스 사용**: 모델 로딩/추론 오버헤드 없음
3. **실시간 반응**: 매우 빠른 제어 루프
4. **디버깅 용이**: 이미지 처리 과정을 시각적으로 확인 가능
5. **데이터 수집 불필요**: 학습 데이터가 필요 없음

## 작동 원리

### 1. 이미지 전처리
- 카메라 이미지를 작은 크기로 리사이즈 (처리 속도 향상)
- ROI(Region of Interest) 설정: 하단 부분만 사용 (라인이 더 명확함)

### 2. 라인 검출
- 그레이스케일 변환
- 가우시안 블러로 노이즈 제거
- 이진화로 흰색 라인 추출
- 모폴로지 연산으로 라인 연결

### 3. 중심 계산
- **하단 중심**: 더 신뢰할 수 있는 기준점
- **상단 중심**: 곡선 방향 예측에 활용
- 두 중심의 차이로 곡선 방향 파악

### 4. PID 제어
- 라인 중심과 이미지 중심의 차이를 에러로 사용
- PID 제어로 서보 모터 각도 계산
- 부드러운 제어를 위한 미분 항 활용

### 5. 트래픽 라이트 감지
- HSV 색공간에서 빨간색/초록색 검출
- 상단 ROI에서 색상 픽셀 수 계산

## 사용 방법

```bash
python3 line_tracing_cv.py
```

## 파라미터 조정

### `line_tracing_cv.py` 파일에서 조정 가능:

```python
# 이미지 크기 (작을수록 빠름, 하지만 정확도 감소)
IMG_WIDTH = 320
IMG_HEIGHT = 240

# ROI 설정 (라인 검출 영역)
ROI_TOP = 0.4  # 상단 40% 제외
ROI_BOTTOM = 1.0  # 하단까지 사용

# 흰색 임계값 (조명 조건에 따라 조정)
WHITE_THRESHOLD = 200  # 0-255

# PID 게인 (차량 특성에 따라 조정)
Kp = 0.8  # 비례 게인 (높을수록 빠른 반응, 하지만 오버슈트 가능)
Ki = 0.0  # 적분 게인 (보통 0)
Kd = 0.1  # 미분 게인 (높을수록 안정적, 하지만 노이즈에 민감)

# 속도
SPEED_NORMAL = 50  # 일반 주행 속도
SPEED_SLOW = 40    # 라인을 잃었을 때 속도
```

## ML 방식 vs CV 방식 비교

| 항목 | ML 방식 | CV 방식 |
|------|---------|---------|
| **처리 속도** | 느림 (추론 시간 필요) | 빠름 (순수 이미지 처리) |
| **정확도** | 높음 (학습 데이터에 따라) | 중간 (조명/조건에 민감) |
| **데이터 필요** | 필요 (수집/라벨링) | 불필요 |
| **조정 난이도** | 어려움 (재학습 필요) | 쉬움 (파라미터만 조정) |
| **리소스 사용** | 높음 (모델 메모리) | 낮음 |
| **일반화** | 좋음 (다양한 조건 학습 가능) | 제한적 (조명 조건에 민감) |

## 추천 사용 시나리오

### CV 방식 추천:
- ✅ 빠른 프로토타이핑
- ✅ 조명 조건이 일정한 경우
- ✅ 리소스가 제한적인 경우
- ✅ 실시간 성능이 중요한 경우

### ML 방식 추천:
- ✅ 다양한 조명 조건
- ✅ 복잡한 라인 패턴
- ✅ 높은 정확도가 필요한 경우
- ✅ 충분한 학습 데이터가 있는 경우

## 하이브리드 접근

두 방식을 결합할 수도 있습니다:
- **일반 주행**: CV 방식 (빠름)
- **복잡한 상황**: ML 방식 (정확함)
- **트래픽 라이트**: ML 방식 (더 정확한 감지)

## 문제 해결

### 라인을 찾지 못하는 경우:
1. `WHITE_THRESHOLD` 값 조정
2. `ROI_TOP` 값 조정 (더 넓은 영역 사용)
3. 조명 조건 개선

### 차량이 흔들리는 경우:
1. `Kp` 값 감소
2. `Kd` 값 증가
3. `SPEED_NORMAL` 값 감소

### 곡선에서 이탈하는 경우:
1. `Kp` 값 증가
2. 상단 중심 가중치 조정 (코드의 0.3 값)

## 추가 개선 아이디어

1. **다중 ROI**: 여러 구간의 라인 중심을 평균
2. **히스토리 평균**: 이전 프레임들의 중심을 평균하여 안정화
3. **속도 조정**: 곡선 각도에 따라 속도 조정
4. **예측 제어**: 상단/하단 중심 차이로 곡선 예측

